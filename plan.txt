Пусть будет аналитика некоторого интернет магазина игра вроде steam

Очевидно должна быть таблица юзеров
пусть у юзеров помимо личных данных + библиотеки игр + какой-то статы активности (общей и по каждой игре)

Понятно, что также должна быть какая-то таблица игр, которые продаются в магазине, статистика по количеству покупок, по времени игроков, проведенных в игре,
жанр игры, платная/бесплатная/по подписке.

Также стоит добавить таблицу с разработчиками, хз пока что какая о них информация должна быть. Наверно выпущенные игры, общий зароботок из которого вычисляется 
комиссия на каждую продажу, какие-то юр.данные, название студии и т.п.

Рекламы в сервисе по продаже чего-то делать пожалуй не стоит, странно как по мне, хотя можно к определенным играм выставлять платные коэффициенты на продвижение,
я правда не уверен, насколько это нужно будет в визуализации. Получится какая-то сложная метрика типа "Как частота показов влияет на количество покупок". 
Хотя это может быть полезно потенциальным покупателся такого платного продвижения.

Кстати, было бы неплохо, чтобы у юзера в личной инфе была страна, чтобы можно было понять, какие игры и где популярны, это явно полязно для персонализации рекомендаций.

Итого на данный момент:

1) таблица юзеров со следующими полями:
- Логин
- Страна и регион
- Хэш пароля (хотя не думаю, что эти данные полезны для аналитики, может этого и не будет)
- Библиотека игр (тут должен быть список внешних ключей на таблицу 2 или будет создана отдельная таблица для связи many-to-many)
- Баланс/сумма трат (Полезная метрика, для анализа того, откуда поступает больше денег)
- топ 5 игр по проведенному времени (для анализа популярности определенных жанров и стилей в разных странах)
- наличие подписки
- ну и можно было бы добавить всякую мелочь типа последее время в сети, но сейчас я не думаю, что это так важно

2) Общая библиотека игр
- название
- жанр
- платная/бесплатная/подписка
- общее время игроков в игре
- количество покупок (если не подписка, если подписка, то пока не придумал)
- внешний ключ на разработчика 
- дата выхода
- ну и опять же какая-нибудь мелкая информация, которой скорее всего не будет

3) Разработчики 
- название студии
- выпущенные игры ? сомневаюсь, что лучше внешний ключ в таблице 2 или список ключей на таблицу 2 тут, наверно удобнее просто в таблице 2 сортировать по имени 
разрабочика данные, так что этого поля скорее всего не будет
- Общий заработок (ну и вот тут как раз наверно проще, чтобы именно игра на разраба ссылалась, чтобы при покупке быстренько его найти, все начислить, проверить)
- какая-нибудь юр инфа, хотя вряд ли она должна храниться в бд магазина

CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE,
    country_code CHAR(2),  -- 'RU', 'US', etc
    region VARCHAR(50),     -- 'Москва', 'California'
    registration_date TIMESTAMP DEFAULT NOW(),
    total_spent DECIMAL(10,2) DEFAULT 0.00,
);

CREATE TABLE games (
    game_id SERIAL PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    developer_id INTEGER REFERENCES developers(developer_id),
    release_date DATE,
    base_price DECIMAL(10,2),  -- 0.00 для бесплатных
    current_price DECIMAL(10,2), -- цена со скидкой
    monetization_type VARCHAR(20),  -- 'free', 'paid'
    genre_main VARCHAR(50),  -- 'RPG', 'Shooter', 'Strategy'
    genre_tags TEXT[],       -- массив тегов: {'action', 'multiplayer', 'coop'}
    age_rating VARCHAR(5),   -- '18+', '12+'
    total_purchases INTEGER DEFAULT 0, -- Кэшированный счетчик
    is_active BOOLEAN DEFAULT TRUE  -- не удаляем игры, а помечаем неактивными
);

CREATE TABLE developers (
    developer_id SERIAL PRIMARY KEY,
    studio_name VARCHAR(100) NOT NULL,
    country_code CHAR(2),
    foundation_year INTEGER,
    total_revenue DECIMAL(15,2) DEFAULT 0.00,  -- вычисляемое поле, обновляем триггером
    contact_email VARCHAR(100)
);

CREATE TABLE play_sessions (
    session_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    game_id INTEGER REFERENCES games(game_id),
    session_start TIMESTAMP,
    session_end TIMESTAMP,
    play_duration INTEGER,  -- в секундах
    achievements_gained INTEGER DEFAULT 0,
    platform VARCHAR(20)  -- 'windows', 'mac', 'linux', 'mobile'
);

CREATE TABLE transactions (
    transaction_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    game_id INTEGER REFERENCES games(game_id),  -- NULL (или какое-нибудь спец значение) если покупка подписки
    transaction_date TIMESTAMP DEFAULT NOW(),
    amount DECIMAL(10,2),
    currency CHAR(3) DEFAULT 'USD',
    transaction_type VARCHAR(30),  -- 'game_purchase', 'subscription', 'refund'
    payment_method VARCHAR(30),   -- 'credit_card', 'paypal', 'google_pay'
    developer_revenue DECIMAL(10,2),  -- 70% от суммы (если 30% комиссия)
    platform_commission DECIMAL(10,2) -- 30% от суммы
);
